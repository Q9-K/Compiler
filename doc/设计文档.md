# 设计文档

> 姓名：蒋康
>
> 学号：20374319
>
> 班级：212113
>
> 学院：软件学院

## 编译器总体设计

我的编译器采用的是多遍处理模式和三端设计模式，词法分析，语法分析，语义分析，中间代码生成，代码优化和目标代码生成每个编译过程都是一遍。其中，前端负责词法分析，语法分析，语义分析和中间代码生成，中端负责中间代码优化，后端负责目标代码生成和目标代码优化。

其中中间代码生成我选择了**LLVM_IR**作为中间代码。

项目总体结构如下：

![image-20231220162259306](https://raw.githubusercontent.com/Q9-K/typora-/main/pictures/202312201622331.png)

Compiler为项目入口，每个Package为Compiler提供对应接口。

```java
/**
 * @author Q9K
 * @date 2023/09/19
 */
public class Compiler {
    public static void main(String[] args) throws IOException {
        System.out.println("Welcome to use Q9K Compiler!");
        new Compiler().run();
    }

    public void run() throws IOException {
        try {
            //获取字符流
            StringBuffer character_stream = Input.getInstance().getCharacterStream();
            //前端部分开始
            //词法分析
            Lexer.getInstance(character_stream).run();
            //获取词法单元流
            List<Token> token_stream = Lexer.getInstance().getTokenStream();
            //语法分析
            Parser.getInstance(token_stream).run();
            //语法树
            Syntax ast = Parser.getInstance().getAst();
            //语义分析
            Visitor.getInstance(ast).run();
            //错误
            ErrorHandler.getInstance().run();
            if (!ErrorHandler.getInstance().hasError()) {
                //生成中间代码llvm_ir
                IRGenerator irGenerator = IRGenerator.getInstance(ast);
                irGenerator.run();
                //后端部分开始
                if (Config.mips_output_open) {
                    MipsGenerator mipsGenerator = MipsGenerator.getInstance(IRModule.getInstance());
                    mipsGenerator.run();
                }
            } else {
                System.out.println("There is something wrong in your code. View error.txt to look for more info.");
            }
            System.exit(0);
        } catch (RuntimeException e) {
            if (Config.DEBUG) {
                System.out.println("You see the following message because DEBUG mode open!");
                e.printStackTrace();
            }
            System.exit(-1);
        }
    }
}
```

Compiler的逻辑非常简单，以源代码为输入，即调用每一个编译过程包提供的接口，除了词法分析外每一个过程的输入为上一个过程的输出，最后生成Mips目标代码。



## 词法分析设计



